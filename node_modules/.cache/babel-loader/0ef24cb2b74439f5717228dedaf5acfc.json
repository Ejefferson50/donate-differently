{"ast":null,"code":"/*\r\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as React from 'react';\nimport { I18n, isEmpty } from '@aws-amplify/core';\nimport { Auth } from '@aws-amplify/auth';\nimport { AuthPiece } from './AuthPiece';\nimport { FormSection, FormField, SectionHeader, SectionBody, SectionFooter, Input, InputLabel, Button, Link, SectionFooterPrimaryContent, SectionFooterSecondaryContent } from '../Amplify-UI/Amplify-UI-Components-React';\nimport { auth } from '../Amplify-UI/data-test-attributes';\n\nvar ConfirmSignIn =\n/** @class */\nfunction (_super) {\n  __extends(ConfirmSignIn, _super);\n\n  function ConfirmSignIn(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._validAuthStates = ['confirmSignIn'];\n    _this.confirm = _this.confirm.bind(_this);\n    _this.checkContact = _this.checkContact.bind(_this);\n    _this.state = {\n      mfaType: 'SMS'\n    };\n    return _this;\n  }\n\n  ConfirmSignIn.prototype.checkContact = function (user) {\n    var _this = this;\n\n    if (!Auth || typeof Auth.verifiedContact !== 'function') {\n      throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n    }\n\n    Auth.verifiedContact(user).then(function (data) {\n      if (!isEmpty(data.verified)) {\n        _this.changeState('signedIn', user);\n      } else {\n        var newUser = Object.assign(user, data);\n\n        _this.changeState('verifyContact', newUser);\n      }\n    });\n  };\n\n  ConfirmSignIn.prototype.confirm = function (event) {\n    var _this = this;\n\n    if (event) {\n      event.preventDefault();\n    }\n\n    var user = this.props.authData;\n    var code = this.inputs.code;\n    var mfaType = user.challengeName === 'SOFTWARE_TOKEN_MFA' ? 'SOFTWARE_TOKEN_MFA' : null;\n\n    if (!Auth || typeof Auth.confirmSignIn !== 'function') {\n      throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n    }\n\n    Auth.confirmSignIn(user, code, mfaType).then(function () {\n      _this.checkContact(user);\n    }).catch(function (err) {\n      return _this.error(err);\n    });\n  };\n\n  ConfirmSignIn.prototype.componentDidUpdate = function () {\n    // logger.debug('component did update with props', this.props);\n    var user = this.props.authData;\n    var mfaType = user && user.challengeName === 'SOFTWARE_TOKEN_MFA' ? 'TOTP' : 'SMS';\n    if (this.state.mfaType !== mfaType) this.setState({\n      mfaType: mfaType\n    });\n  };\n\n  ConfirmSignIn.prototype.showComponent = function (theme) {\n    var _this = this;\n\n    var hide = this.props.hide;\n\n    if (hide && hide.includes(ConfirmSignIn)) {\n      return null;\n    }\n\n    return React.createElement(FormSection, {\n      theme: theme,\n      \"data-test\": auth.confirmSignIn.section\n    }, React.createElement(SectionHeader, {\n      theme: theme,\n      \"data-test\": auth.confirmSignIn.headerSection\n    }, I18n.get('Confirm ' + this.state.mfaType + ' Code')), React.createElement(\"form\", {\n      onSubmit: this.confirm,\n      \"data-test\": auth.confirmSignIn.bodySection\n    }, React.createElement(SectionBody, {\n      theme: theme\n    }, React.createElement(FormField, {\n      theme: theme\n    }, React.createElement(InputLabel, {\n      theme: theme\n    }, I18n.get('Code'), \" *\"), React.createElement(Input, {\n      autoFocus: true,\n      placeholder: I18n.get('Code'),\n      theme: theme,\n      key: \"code\",\n      name: \"code\",\n      autoComplete: \"off\",\n      onChange: this.handleInputChange,\n      \"data-test\": auth.confirmSignIn.codeInput\n    }))), React.createElement(SectionFooter, {\n      theme: theme\n    }, React.createElement(SectionFooterPrimaryContent, {\n      theme: theme,\n      \"data-test\": auth.confirmSignIn.confirmButton\n    }, React.createElement(Button, {\n      theme: theme,\n      type: \"submit\"\n    }, I18n.get('Confirm'))), React.createElement(SectionFooterSecondaryContent, {\n      theme: theme\n    }, React.createElement(Link, {\n      theme: theme,\n      onClick: function () {\n        return _this.changeState('signIn');\n      },\n      \"data-test\": auth.confirmSignIn.backToSignInLink\n    }, I18n.get('Back to Sign In'))))));\n  };\n\n  return ConfirmSignIn;\n}(AuthPiece);\n\nexport { ConfirmSignIn };\n/**\r\n * @deprecated use named import\r\n */\n\nexport default ConfirmSignIn;","map":{"version":3,"sources":["../../src/Auth/ConfirmSignIn.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\r\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as React from 'react';\r\nimport { I18n, isEmpty } from '@aws-amplify/core';\r\nimport { Auth } from '@aws-amplify/auth';\r\nimport { AuthPiece } from './AuthPiece';\r\nimport { FormSection, FormField, SectionHeader, SectionBody, SectionFooter, Input, InputLabel, Button, Link, SectionFooterPrimaryContent, SectionFooterSecondaryContent, } from '../Amplify-UI/Amplify-UI-Components-React';\r\nimport { auth } from '../Amplify-UI/data-test-attributes';\r\nvar ConfirmSignIn = /** @class */ (function (_super) {\r\n    __extends(ConfirmSignIn, _super);\r\n    function ConfirmSignIn(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this._validAuthStates = ['confirmSignIn'];\r\n        _this.confirm = _this.confirm.bind(_this);\r\n        _this.checkContact = _this.checkContact.bind(_this);\r\n        _this.state = {\r\n            mfaType: 'SMS',\r\n        };\r\n        return _this;\r\n    }\r\n    ConfirmSignIn.prototype.checkContact = function (user) {\r\n        var _this = this;\r\n        if (!Auth || typeof Auth.verifiedContact !== 'function') {\r\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\r\n        }\r\n        Auth.verifiedContact(user).then(function (data) {\r\n            if (!isEmpty(data.verified)) {\r\n                _this.changeState('signedIn', user);\r\n            }\r\n            else {\r\n                var newUser = Object.assign(user, data);\r\n                _this.changeState('verifyContact', newUser);\r\n            }\r\n        });\r\n    };\r\n    ConfirmSignIn.prototype.confirm = function (event) {\r\n        var _this = this;\r\n        if (event) {\r\n            event.preventDefault();\r\n        }\r\n        var user = this.props.authData;\r\n        var code = this.inputs.code;\r\n        var mfaType = user.challengeName === 'SOFTWARE_TOKEN_MFA' ? 'SOFTWARE_TOKEN_MFA' : null;\r\n        if (!Auth || typeof Auth.confirmSignIn !== 'function') {\r\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\r\n        }\r\n        Auth.confirmSignIn(user, code, mfaType)\r\n            .then(function () {\r\n            _this.checkContact(user);\r\n        })\r\n            .catch(function (err) { return _this.error(err); });\r\n    };\r\n    ConfirmSignIn.prototype.componentDidUpdate = function () {\r\n        // logger.debug('component did update with props', this.props);\r\n        var user = this.props.authData;\r\n        var mfaType = user && user.challengeName === 'SOFTWARE_TOKEN_MFA' ? 'TOTP' : 'SMS';\r\n        if (this.state.mfaType !== mfaType)\r\n            this.setState({ mfaType: mfaType });\r\n    };\r\n    ConfirmSignIn.prototype.showComponent = function (theme) {\r\n        var _this = this;\r\n        var hide = this.props.hide;\r\n        if (hide && hide.includes(ConfirmSignIn)) {\r\n            return null;\r\n        }\r\n        return (React.createElement(FormSection, { theme: theme, \"data-test\": auth.confirmSignIn.section },\r\n            React.createElement(SectionHeader, { theme: theme, \"data-test\": auth.confirmSignIn.headerSection }, I18n.get('Confirm ' + this.state.mfaType + ' Code')),\r\n            React.createElement(\"form\", { onSubmit: this.confirm, \"data-test\": auth.confirmSignIn.bodySection },\r\n                React.createElement(SectionBody, { theme: theme },\r\n                    React.createElement(FormField, { theme: theme },\r\n                        React.createElement(InputLabel, { theme: theme },\r\n                            I18n.get('Code'),\r\n                            \" *\"),\r\n                        React.createElement(Input, { autoFocus: true, placeholder: I18n.get('Code'), theme: theme, key: \"code\", name: \"code\", autoComplete: \"off\", onChange: this.handleInputChange, \"data-test\": auth.confirmSignIn.codeInput }))),\r\n                React.createElement(SectionFooter, { theme: theme },\r\n                    React.createElement(SectionFooterPrimaryContent, { theme: theme, \"data-test\": auth.confirmSignIn.confirmButton },\r\n                        React.createElement(Button, { theme: theme, type: \"submit\" }, I18n.get('Confirm'))),\r\n                    React.createElement(SectionFooterSecondaryContent, { theme: theme },\r\n                        React.createElement(Link, { theme: theme, onClick: function () { return _this.changeState('signIn'); }, \"data-test\": auth.confirmSignIn.backToSignInLink }, I18n.get('Back to Sign In')))))));\r\n    };\r\n    return ConfirmSignIn;\r\n}(AuthPiece));\r\nexport { ConfirmSignIn };\r\n/**\r\n * @deprecated use named import\r\n */\r\nexport default ConfirmSignIn;\r\n//# sourceMappingURL=ConfirmSignIn.js.map"]},"metadata":{},"sourceType":"module"}